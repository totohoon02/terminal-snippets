pk() {
    # 포트킬 pk 8080 | 동작 안함
    local port=$1

    if [[ -z "$port" ]]; then
        echo "Usage: lck <port>"
        return 1
    fi

    # lsof -t 옵션은 PID만 출력합니다.
    # sudo를 붙여야 다른 사용자의 프로세스도 확인 가능합니다.
    local pid_to_kill=$(sudo lsof -t -i:"$port")

    if [[ -n "$pid_to_kill" ]]; then
        echo "Killing process $pid_to_kill on port $port..."
        echo "$pid_to_kill" | xargs sudo kill -9
        echo "✅ Done."
    else
        echo "❌ No process found on port $port"
    fi
}

host() {
    # 로컬호스트 페이지 열기 host 8080 | host 8080 -s
    if [ -z "$1" ]; then
        echo "Usage: host <port> [--secret]"
        return 1
    fi

    local port="$1"
    local url="http://localhost:$port"
    local browser_flag=""

    if [[ "$2" == "--secret" || "$2" == "-s" ]]; then
        browser_flag="--incognito"
    fi

    if [[ "$OSTYPE" == "msys" || "$OSTYPE" == "cygwin" || "$OSTYPE" == "win32" ]]; then
        start chrome $browser_flag "$url"
    elif [[ "$OSTYPE" == "darwin"* ]]; then
        if [ -n "$browser_flag" ]; then
            open -a "Google Chrome" --new --args "$browser_flag" "$url"
        else
            open -a "Google Chrome" "$url"
        fi
    elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
        if [ -n "$browser_flag" ]; then
            google-chrome "$browser_flag" "$url" &>/dev/null &
        else
            xdg-open "$url"
        fi
    else
        echo "Unsupported operating system: $OSTYPE"
        return 1
    fi
}


culst(){
    # 로컬호스트 페이지 컬 culst 8080
    if [ -z "$1" ]; then
        echo "Usage: cost <port>"
        return 1
    fi

    local port="$1"
    curl "http://localhost:$port"
}

rcopy(){
    # deprecated
    reversed=$(echo $1 | awk '{ for(i=length; i>0; i--) printf "%s", substr($0, i, 1); print "" }')
    
    if [[ "$OSTYPE" == "linux-gnu"* ]]; then
        if command -v xclip &> /dev/null; then
            echo "$reversed" | xclip -selection clipboard
        else
            echo "xclip이 설치되어 있지 않습니다. 설치 후 사용하세요."
        fi
    elif [[ "$OSTYPE" == "darwin"* ]]; then
        echo "$reversed" | pbcopy
    elif [[ "$OSTYPE" == "cygwin" || "$OSTYPE" == "msys" ]]; then
        echo "$reversed" | clip
    else
        echo "Not supported OS"
    fi
}

after() {
    # deprecated
    if [ "$1" = "-h" ] || [ "$1" = "--help" ]; then
        echo "사용법: after <일수> [월-일]"
        echo "예시:"
        echo "  after 20           # 오늘 기준 20일 후 날짜 출력"
        echo "  after 20 04-01     # 해당 연도 4월 1일 기준 20일 후 날짜 출력"
        return 0
    fi

    if [ -z "$1" ]; then
        echo "start 20 rest 8"
        echo "날짜는 겹치게"
        return 1
    fi

    if [ -n "$2" ]; then
        year=$(date +%Y)
        base_date="$year-$2"
    else
        base_date=$(date +%Y-%m-%d)
    fi

    future_date=$(date -d "$base_date +$1 days" +%Y-%m-%d)
    echo $future_date
}


lck(){
    # locker 레포지토리에서 파일 가져오기 lck -d redis | lck -y swagger | lck -j swagger
    # get file
    local baseUrl="https://raw.githubusercontent.com/totohoon02/locker/refs/heads/main"
    
    # help
    if [[ "$1" == "--help" || "$1" == "-h" ]]; then
        curl $baseUrl/help.txt
        return 0
    fi

    # No input    
    if [ -z "$1" ]; then
        echo "Usage: lck <filename | --docker/-d> [docker:filename]"
        return 1
    fi

    # docker
    if [[ "$1" == "--docker" || "$1" == "-d" ]]; then
        if [ -z "$2" ]; then
            echo "Not specified Docker"
            return 1
        fi
        local dir="$2"
        mkdir "$dir"
        curl -sSL "$baseUrl/docker/$dir/docker-compose.yml" -o "./$dir/docker-compose.yml"

    # Java config
    elif [[ "$1" == "--java" || "$1" == "-j" ]]; then
        if [ -z "$2" ]; then
            echo "Not specified Java"
            return 1
        fi
        
        local dir="$2"
        dir="$(tr '[:lower:]' '[:upper:]' <<< "${dir:0:1}")${dir:1}"
        curl -sSL "$baseUrl/java/${dir}Config.java" -o "${dir}Config.java"

    # config.yml
    elif [[ "$1" == "--yml" || "$1" == "-y" ]]; then
        if [ -z "$2" ]; then
            echo "Not specified yml"
            return 1
        fi
        local dir="$2"
        dir=$(echo "$dir" | tr '[:upper:]' '[:lower:]')
        curl -sSL "$baseUrl/${dir}Config.yml" -o "${dir}Config.yml"
    else
        local dir="$1"
        dir=$(echo "$dir" | tr '[:upper:]' '[:lower:]')
        curl -sSL "$baseUrl/${dir}" -o "${dir}"
    fi
}

alias sb="source ~/.bash_profile"
alias sz="source ~/.zshrc"
