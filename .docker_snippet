alias up="docker compose up -d"
alias down="docker compose down"
alias dps="docker ps"

pydocker() {
    echo 'FROM python:3.10-slim' > Dockerfile
    echo '' >> Dockerfile
    echo '# 1. uv 설치' >> Dockerfile
    echo 'RUN pip install uv' >> Dockerfile
    echo '' >> Dockerfile
    echo 'WORKDIR /app' >> Dockerfile
    echo '' >> Dockerfile
    echo '# 2. pyproject.toml & uv.lock 복사' >> Dockerfile
    echo 'COPY pyproject.toml uv.lock ./' >> Dockerfile
    echo '' >> Dockerfile
    echo '# 3. 의존성 설치 (재현성 보장)' >> Dockerfile
    echo 'RUN uv sync --frozen --no-dev' >> Dockerfile
    echo '' >> Dockerfile
    echo '# 4. 애플리케이션 복사' >> Dockerfile
    echo 'COPY . .' >> Dockerfile
    echo '' >> Dockerfile
    echo 'EXPOSE 8000' >> Dockerfile
    echo '' >> Dockerfile
    echo 'CMD ["uv", "run", "uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]' >> Dockerfile
}


jdocker() {
    cat <<EOF > Dockerfile
FROM gradle:jdk21 AS build
WORKDIR /app

# 의존성 캐싱
COPY build.gradle settings.gradle ./
RUN gradle dependencies --no-daemon > /dev/null 2>&1 || true

# 빌드
COPY src ./src
RUN gradle clean bootJar -x test --no-daemon

# 실행 환경
FROM eclipse-temurin:21-jre-jammy
WORKDIR /app

COPY --from=build /app/build/libs/*.jar app.jar

EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]
EOF
}

recon(){
    down
    up --build
}

dkrun() {
    port=$1
    iName=$2

    if [ -z "$port" ] || [ -z "$iName" ]; then
        echo "❌ 오류: 포트 번호와 이미지 이름을 입력하세요."
        echo "사용법: drun <Ex_port:Int_port> <image_name>"
        return 
    fi

    docker run -d -p "$port" "$iName"
}

build() {
    # 인자가 없으면 사용법 출력
    if [ -z "$1" ]; then
        echo "사용법: build [이미지이름:태그]"
        return 1
    fi
    
    docker buildx build --load -t kubs .
}

rmi(){
    for image_id in $(docker images --filter "dangling=true" -q); do
        docker rmi "$image_id"
    done
}

dxc() {
    if [ -z "$1" ]; then
        echo "Usage: dxc <container_name>"
        return 1
    fi
    docker exec -it "$1" bash
}
